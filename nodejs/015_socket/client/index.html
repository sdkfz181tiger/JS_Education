<!DOCTYPE html>
<html lang="ja">
<head>
	<meta http-equiv="content-type" content="text/html" charset="utf-8">
	<!-- JQuery -->
	<script src="./js/jquery/jquery.min.js"></script>
</head>
<body>
	<h1>WebSocket</h1>

	<input id="myInput" type="text" value="This is test!!"/>
	<button id="myBtn">Send</button>

	<table id="myTable"></table>

	<script type="text/javascript">

	//==========
	// WebSocket
	let ws;

	// Load
	$(window).on("load", ()=>{
		console.log("Load!!");

		// Initialize
		ws = new WebSocket("ws://localhost:3030");

		// onOpen
		ws.onopen = (e)=>{
			console.log("onOpen");
		}

		ws.onmessage = (e)=>{
			console.log("onMessage:" + e.data);
			appendMessage(e.data);
		}

		// onClose
		ws.onclose = (e)=>{
			console.log("onClose");
		}

		// onError
		ws.onerror = (e)=>{
			console.log("onError");
		}
	});

	// Unload
	$(window).on("unload", ()=>{
		console.log("Unload!!");
		ws.close();
	});

	// Ready
	$(document).ready(()=>{
		console.log("Hello Client!!");

		//==========
		// UI
		$("#myBtn").on("click", (e)=>{
			// Send massage
			let msg = $("#myInput").val();
			if(ws !== null) ws.send(msg);
		});
	});

	function appendMessage(msg){

		// Append
		let tag = "<tr><td>" + msg + "</td></tr>";
		$("#myTable").append(tag);
	}
	</script>
</body>
</html>